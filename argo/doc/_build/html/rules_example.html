

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Rules Example &mdash; ARGO  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Convert Processed Conditions to General Example" href="convert_processed_conditions_to_general_example.html" />
    <link rel="prev" title="argo.rules package" href="argo.rules.html" />
    <link href="_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> ARGO
          

          
            
            <img src="_static/argo_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="argo.html">argo package</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="argo.html#notebooks">Notebooks</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="argo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="argo.argo_utils.html">argo.argo_utils package</a></li>
<li class="toctree-l3"><a class="reference internal" href="argo.correlation_reduction.html">argo.correlation_reduction package</a></li>
<li class="toctree-l3"><a class="reference internal" href="argo.read_data.html">argo.read_data package</a></li>
<li class="toctree-l3"><a class="reference internal" href="argo.rule_application.html">argo.rule_application package</a></li>
<li class="toctree-l3"><a class="reference internal" href="argo.rule_filtering.html">argo.rule_filtering package</a></li>
<li class="toctree-l3"><a class="reference internal" href="argo.rule_generation.html">argo.rule_generation package</a></li>
<li class="toctree-l3"><a class="reference internal" href="argo.rule_optimisation.html">argo.rule_optimisation package</a></li>
<li class="toctree-l3"><a class="reference internal" href="argo.rule_scoring.html">argo.rule_scoring package</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="argo.rules.html">argo.rules package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="argo.rules.html#notebooks">Notebooks</a></li>
<li class="toctree-l4"><a class="reference internal" href="argo.rules.html#subpackages">Subpackages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="argo.simility_apis.html">argo.simility_apis package</a></li>
<li class="toctree-l3"><a class="reference internal" href="argo.simility_requests.html">argo.simility_requests package</a></li>
<li class="toctree-l3"><a class="reference internal" href="argo.system_config_generation.html">argo.system_config_generation package</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ARGO</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="argo.html">argo package</a> &raquo;</li>
        
          <li><a href="argo.rules.html">argo.rules package</a> &raquo;</li>
        
      <li>Rules Example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/rules_example.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Rules-Example">
<h1>Rules Example<a class="headerlink" href="#Rules-Example" title="Permalink to this headline">¶</a></h1>
<p>This notebook contains an example of how the Rules class can be used to define a set of rules using one of three representations, and how we can switch between the different representations.</p>
<p>A rule set can be defined using one of the two following representations:</p>
<ul class="simple">
<li><p>System-ready representation - this is the format used in the Simility system to define a rule’s conditions.</p></li>
<li><p>Dictionary representation - a simpler version of the format in which rules are stored in the Simility system.</p></li>
<li><p>String representation - Pythonic method of applying a rule to a dataset. The logic of each rule is saved to a string. Python’s built in eval() function can be used to evaluate the rule using this representation on a dataset.</p></li>
</ul>
<p>We can also convert either of the above representations to the lambda expression format. This format allows different values to be injected into the rule string, which can then be evaluated on a dataset. This is very useful for when we optimise existing rules on a dataset.</p>
<div class="section" id="Requirements">
<h2>Requirements<a class="headerlink" href="#Requirements" title="Permalink to this headline">¶</a></h2>
<p>To run, you’ll need the following:</p>
<ul class="simple">
<li><p>Install the Rules package - see the readme for more information.</p></li>
</ul>
<hr class="docutils" />
</div>
<div class="section" id="Import-packages">
<h2>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">rules.rules</span> <span class="kn">import</span> <span class="n">Rules</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Create-dummy-dataset">
<h2>Create dummy dataset<a class="headerlink" href="#Create-dummy-dataset" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="s1">&#39;num_items&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="s1">&#39;ml_cc_v0&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;bad_login&#39;</span><span class="p">,</span> <span class="s1">&#39;bad_checkout&#39;</span><span class="p">,</span> <span class="s1">&#39;fraud_login&#39;</span><span class="p">,</span> <span class="s1">&#39;fraud_checkout&#39;</span><span class="p">,</span> <span class="s1">&#39;signup&#39;</span><span class="p">,</span> <span class="s1">&#39;bad_signup&#39;</span><span class="p">,</span> <span class="s1">&#39;fraud_signup&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">&#39;ip_address&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;192.168.0.1&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="mi">500</span><span class="p">,</span>
        <span class="s1">&#39;ip_isp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;BT&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">250</span>

    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
<div class="section" id="Instantiate-Rule-class">
<h2>Instantiate Rule class<a class="headerlink" href="#Instantiate-Rule-class" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Using-system-representation">
<h3>Using system representation<a class="headerlink" href="#Using-system-representation" title="Permalink to this headline">¶</a></h3>
<p>As mentioned above, we can define a rule set using one of the three following representations - System-ready, Dictionary or String.</p>
<p>Let’s first define a set of rules using the system-ready representation. These conditions can be pulled from a Simility system using the <em>return_rule_info_from_simility</em> module in the <em>simility_requests</em> sub-package.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">system_dicts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;rules&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="s1">&#39;OR&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;rules&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id.sum_approved_txn_amt_per_paypalid_1day&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id.sum_approved_txn_amt_per_paypalid_1day&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;greater_or_equal&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;value.60.0&#39;</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id.sum_approved_txn_amt_per_paypalid_7day&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id.sum_approved_txn_amt_per_paypalid_7day&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;greater&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;value.120.0&#39;</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id.sum_approved_txn_amt_per_paypalid_30day&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id.sum_approved_txn_amt_per_paypalid_30day&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;less_or_equal&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;value.500.0&#39;</span><span class="p">}],</span>
                                         <span class="p">},</span>
                                        <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;num_items&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;num_items&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;value.1&#39;</span><span class="p">},</span>
                                        <span class="p">]},</span>
                    <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;rules&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;ml_cc_v0&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;ml_cc_v0&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;less&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;value.0.315&#39;</span><span class="p">},</span>
                                        <span class="p">{</span><span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="s1">&#39;OR&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;rules&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;value.checkout&#39;</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;begins_with&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;value.checkout&#39;</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;ends_with&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;value.checkout&#39;</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;contains&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;value.checkout&#39;</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;ip_address&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;ip_address&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;is_not_null&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;ip_isp&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;ip_isp&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;is_not_empty&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
                                                   <span class="p">]}]}}</span>
</pre></div>
</div>
</div>
<p>Now that we have defined our rule set using the system-ready representation, we can instantiate the Rule class.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span> <span class="o">=</span> <span class="n">Rules</span><span class="p">(</span><span class="n">system_dicts</span><span class="o">=</span><span class="n">system_dicts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Once the class is instantiated, we can switch to the dictionary or string representations using the <em>as_rule_dicts()</em> and <em>as_rule_strings()</em> methods respectively:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_dicts</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">as_rule_dicts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_strings</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">as_rule_strings</span><span class="p">(</span><span class="n">as_numpy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Outputs">
<h4>Outputs<a class="headerlink" href="#Outputs" title="Permalink to this headline">¶</a></h4>
<p>The <em>.as_rule_dicts()</em> method returns a dictionary of the set of rules defined using the standard ARGO dictionary format (values) and their names (keys). It also saves this dictionary as the class attribute <em>rule_dicts</em>.</p>
<p>The <em>.as_rule_strings()</em> method returns a dictionary of the set of rules defined using the standard ARGO string format (values) and their names (keys). It also saves this dictionary as the class attribute <em>rule_strings</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_dicts</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: {&#39;condition&#39;: &#39;AND&#39;,
  &#39;rules&#39;: [{&#39;condition&#39;: &#39;OR&#39;,
    &#39;rules&#39;: [{&#39;field&#39;: &#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;,
      &#39;operator&#39;: &#39;greater_or_equal&#39;,
      &#39;value&#39;: 60.0},
     {&#39;field&#39;: &#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;,
      &#39;operator&#39;: &#39;greater&#39;,
      &#39;value&#39;: 120.0},
     {&#39;field&#39;: &#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;,
      &#39;operator&#39;: &#39;less_or_equal&#39;,
      &#39;value&#39;: 500.0}]},
   {&#39;field&#39;: &#39;num_items&#39;, &#39;operator&#39;: &#39;equal&#39;, &#39;value&#39;: 1.0}]},
 &#39;Rule2&#39;: {&#39;condition&#39;: &#39;AND&#39;,
  &#39;rules&#39;: [{&#39;field&#39;: &#39;ml_cc_v0&#39;, &#39;operator&#39;: &#39;less&#39;, &#39;value&#39;: 0.315},
   {&#39;condition&#39;: &#39;OR&#39;,
    &#39;rules&#39;: [{&#39;field&#39;: &#39;method_clean&#39;,
      &#39;operator&#39;: &#39;equal&#39;,
      &#39;value&#39;: &#39;checkout&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;, &#39;operator&#39;: &#39;begins_with&#39;, &#39;value&#39;: &#39;checkout&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;, &#39;operator&#39;: &#39;ends_with&#39;, &#39;value&#39;: &#39;checkout&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;, &#39;operator&#39;: &#39;contains&#39;, &#39;value&#39;: &#39;checkout&#39;},
     {&#39;field&#39;: &#39;ip_address&#39;, &#39;operator&#39;: &#39;is_not_null&#39;, &#39;value&#39;: None},
     {&#39;field&#39;: &#39;ip_isp&#39;, &#39;operator&#39;: &#39;is_not_empty&#39;, &#39;value&#39;: None}]}]}}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_strings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: &#34;((X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)|(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&gt;120.0)|(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;]&lt;=500.0))&amp;(X[&#39;num_items&#39;]==1.0)&#34;,
 &#39;Rule2&#39;: &#34;(X[&#39;ml_cc_v0&#39;]&lt;0.315)&amp;((X[&#39;method_clean&#39;]==&#39;checkout&#39;)|(X[&#39;method_clean&#39;].str.startswith(&#39;checkout&#39;, na=False))|(X[&#39;method_clean&#39;].str.endswith(&#39;checkout&#39;, na=False))|(X[&#39;method_clean&#39;].str.contains(&#39;checkout&#39;, na=False, regex=False))|(~X[&#39;ip_address&#39;].isna())|(X[&#39;ip_isp&#39;].fillna(&#39;&#39;)!=&#39;&#39;))&#34;}
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Using-dictionary-representation">
<h3>Using dictionary representation<a class="headerlink" href="#Using-dictionary-representation" title="Permalink to this headline">¶</a></h3>
<p>Let’s now define the same set of rules using the dictionary representation:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_dicts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;rules&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="s1">&#39;OR&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;rules&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;greater_or_equal&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">60.0</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;greater&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">120.0</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;less_or_equal&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">}]},</span>
                                      <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;num_items&#39;</span><span class="p">,</span> <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}]},</span>
                  <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;rules&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;ml_cc_v0&#39;</span><span class="p">,</span> <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;less&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.315</span><span class="p">},</span>
                                      <span class="p">{</span><span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="s1">&#39;OR&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;rules&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;checkout&#39;</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;begins_with&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;checkout&#39;</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;ends_with&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;checkout&#39;</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;contains&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;checkout&#39;</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;ip_address&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;is_not_null&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;ip_isp&#39;</span><span class="p">,</span> <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;is_not_empty&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}]}]}}</span>
</pre></div>
</div>
</div>
<p>Now that we have defined our rule set using the dictionary representation, we can instantiate the Rule class.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span> <span class="o">=</span> <span class="n">Rules</span><span class="p">(</span><span class="n">rule_dicts</span><span class="o">=</span><span class="n">rule_dicts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Once the class is instantiated, we can switch to the system-ready and string representations using the <em>as_system_dicts()</em> and <em>as_rule_strings()</em> methods respectively. For the former method, we need to provide the Cassandra datatypes for each pipeline output field, as well as their Cassandra field names. This can be returned using the <em>return_cassandra_dtypes</em> module from the <em>simility_requests</em> sub-package (but are defined explicitly below in this example):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">field_datatypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;</span><span class="p">:</span> <span class="s1">&#39;DOUBLE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;</span><span class="p">:</span> <span class="s1">&#39;DOUBLE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;</span><span class="p">:</span> <span class="s1">&#39;DOUBLE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num_items&#39;</span><span class="p">:</span> <span class="s1">&#39;INT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ml_cc_v0&#39;</span><span class="p">:</span> <span class="s1">&#39;DOUBLE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ip_address&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ip_isp&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ip_address&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ip_isp&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;forwarder_address&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;is_shipping_billing_address_same&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ad_price_type&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ad_price_type&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ip_country_iso_code&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;country_id&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;billing_country&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span>
<span class="p">}</span>
<span class="n">cassandra_field_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id.sum_approved_txn_amt_per_paypalid_1day&#39;</span><span class="p">,</span>
    <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id.sum_approved_txn_amt_per_paypalid_7day&#39;</span><span class="p">,</span>
    <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id.sum_approved_txn_amt_per_paypalid_30day&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num_items&#39;</span><span class="p">:</span> <span class="s1">&#39;num_items&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ml_cc_v0&#39;</span><span class="p">:</span> <span class="s1">&#39;ml_cc_v0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ip_address&#39;</span><span class="p">:</span> <span class="s1">&#39;ip_address&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ip_isp&#39;</span><span class="p">:</span> <span class="s1">&#39;ip_isp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ip_address&#39;</span><span class="p">:</span> <span class="s1">&#39;ip_address&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ip_isp&#39;</span><span class="p">:</span> <span class="s1">&#39;ip_isp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;forwarder_address&#39;</span><span class="p">:</span> <span class="s1">&#39;forwarder_address&#39;</span><span class="p">,</span>
    <span class="s1">&#39;is_shipping_billing_address_same&#39;</span><span class="p">:</span> <span class="s1">&#39;is_shipping_billing_address_same&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ad_price_type&#39;</span><span class="p">:</span> <span class="s1">&#39;ad_price_type&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ad_price_type&#39;</span><span class="p">:</span> <span class="s1">&#39;ad_price_type&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ip_country_iso_code&#39;</span><span class="p">:</span> <span class="s1">&#39;ip_country_iso_code&#39;</span><span class="p">,</span>
    <span class="s1">&#39;country_id&#39;</span><span class="p">:</span> <span class="s1">&#39;country_id&#39;</span><span class="p">,</span>
    <span class="s1">&#39;billing_country&#39;</span><span class="p">:</span> <span class="s1">&#39;billing_country&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">system_dicts</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">as_system_dicts</span><span class="p">(</span><span class="n">field_datatypes</span><span class="o">=</span><span class="n">field_datatypes</span><span class="p">,</span> <span class="n">cassandra_field_names</span><span class="o">=</span><span class="n">cassandra_field_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_strings</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">as_rule_strings</span><span class="p">(</span><span class="n">as_numpy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h4>Outputs<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>The <em>.as_system_dicts()</em> method returns a dictionary of the set of rules defined using the system-ready format (values) and their names (keys). It also saves this dictionary as the class attribute <em>system_dicts</em>.</p>
<p>The <em>.as_rule_strings()</em> method returns a dictionary of the set of rules defined using the standard ARGO string format (values) and their names (keys). It also saves this dictionary as the class attribute <em>rule_strings</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">system_dicts</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: {&#39;condition&#39;: &#39;AND&#39;,
  &#39;rules&#39;: [{&#39;condition&#39;: &#39;OR&#39;,
    &#39;rules&#39;: [{&#39;field&#39;: &#39;payer_id.sum_approved_txn_amt_per_paypalid_1day&#39;,
      &#39;operator&#39;: &#39;greater_or_equal&#39;,
      &#39;value&#39;: &#39;value.60.0&#39;,
      &#39;id&#39;: &#39;payer_id.sum_approved_txn_amt_per_paypalid_1day&#39;,
      &#39;type&#39;: &#39;double&#39;},
     {&#39;field&#39;: &#39;payer_id.sum_approved_txn_amt_per_paypalid_7day&#39;,
      &#39;operator&#39;: &#39;greater&#39;,
      &#39;value&#39;: &#39;value.120.0&#39;,
      &#39;id&#39;: &#39;payer_id.sum_approved_txn_amt_per_paypalid_7day&#39;,
      &#39;type&#39;: &#39;double&#39;},
     {&#39;field&#39;: &#39;payer_id.sum_approved_txn_amt_per_paypalid_30day&#39;,
      &#39;operator&#39;: &#39;less_or_equal&#39;,
      &#39;value&#39;: &#39;value.500.0&#39;,
      &#39;id&#39;: &#39;payer_id.sum_approved_txn_amt_per_paypalid_30day&#39;,
      &#39;type&#39;: &#39;double&#39;}]},
   {&#39;field&#39;: &#39;num_items&#39;,
    &#39;operator&#39;: &#39;equal&#39;,
    &#39;value&#39;: &#39;value.1&#39;,
    &#39;id&#39;: &#39;num_items&#39;,
    &#39;type&#39;: &#39;integer&#39;}]},
 &#39;Rule2&#39;: {&#39;condition&#39;: &#39;AND&#39;,
  &#39;rules&#39;: [{&#39;field&#39;: &#39;ml_cc_v0&#39;,
    &#39;operator&#39;: &#39;less&#39;,
    &#39;value&#39;: &#39;value.0.315&#39;,
    &#39;id&#39;: &#39;ml_cc_v0&#39;,
    &#39;type&#39;: &#39;double&#39;},
   {&#39;condition&#39;: &#39;OR&#39;,
    &#39;rules&#39;: [{&#39;field&#39;: &#39;method_clean&#39;,
      &#39;operator&#39;: &#39;equal&#39;,
      &#39;value&#39;: &#39;value.checkout&#39;,
      &#39;id&#39;: &#39;method_clean&#39;,
      &#39;type&#39;: &#39;string&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;,
      &#39;operator&#39;: &#39;begins_with&#39;,
      &#39;value&#39;: &#39;value.checkout&#39;,
      &#39;id&#39;: &#39;method_clean&#39;,
      &#39;type&#39;: &#39;string&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;,
      &#39;operator&#39;: &#39;ends_with&#39;,
      &#39;value&#39;: &#39;value.checkout&#39;,
      &#39;id&#39;: &#39;method_clean&#39;,
      &#39;type&#39;: &#39;string&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;,
      &#39;operator&#39;: &#39;contains&#39;,
      &#39;value&#39;: &#39;value.checkout&#39;,
      &#39;id&#39;: &#39;method_clean&#39;,
      &#39;type&#39;: &#39;string&#39;},
     {&#39;field&#39;: &#39;ip_address&#39;,
      &#39;operator&#39;: &#39;is_not_null&#39;,
      &#39;value&#39;: None,
      &#39;id&#39;: &#39;ip_address&#39;,
      &#39;type&#39;: &#39;string&#39;},
     {&#39;field&#39;: &#39;ip_isp&#39;,
      &#39;operator&#39;: &#39;is_not_empty&#39;,
      &#39;value&#39;: None,
      &#39;id&#39;: &#39;ip_isp&#39;,
      &#39;type&#39;: &#39;string&#39;}]}]}}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_strings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: &#34;((X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)|(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&gt;120.0)|(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;]&lt;=500.0))&amp;(X[&#39;num_items&#39;]==1.0)&#34;,
 &#39;Rule2&#39;: &#34;(X[&#39;ml_cc_v0&#39;]&lt;0.315)&amp;((X[&#39;method_clean&#39;]==&#39;checkout&#39;)|(X[&#39;method_clean&#39;].str.startswith(&#39;checkout&#39;, na=False))|(X[&#39;method_clean&#39;].str.endswith(&#39;checkout&#39;, na=False))|(X[&#39;method_clean&#39;].str.contains(&#39;checkout&#39;, na=False, regex=False))|(~X[&#39;ip_address&#39;].isna())|(X[&#39;ip_isp&#39;].fillna(&#39;&#39;)!=&#39;&#39;))&#34;}
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Using-string-representation">
<h3>Using string representation<a class="headerlink" href="#Using-string-representation" title="Permalink to this headline">¶</a></h3>
<p>Now let’s instead define the same set of rules using the string representation:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_strings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="s2">&quot;((X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)|(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&gt;120.0)|(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;]&lt;=500.0))&amp;(X[&#39;num_items&#39;]==1.0)&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;ml_cc_v0&#39;]&lt;0.315)&amp;((X[&#39;method_clean&#39;]==&#39;checkout&#39;)|(X[&#39;method_clean&#39;].str.startswith(&#39;checkout&#39;, na=False))|(X[&#39;method_clean&#39;].str.endswith(&#39;checkout&#39;, na=False))|(X[&#39;method_clean&#39;].str.contains(&#39;checkout&#39;, na=False))|(~X[&#39;ip_address&#39;].isna())|(X[&#39;ip_isp&#39;].fillna(&#39;&#39;)!=&#39;&#39;))&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Now that we have defined our rule set using the string representation, we can instantiate the Rule class.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span> <span class="o">=</span> <span class="n">Rules</span><span class="p">(</span><span class="n">rule_strings</span><span class="o">=</span><span class="n">rule_strings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Once the class is instantiated, we can switch to the system-ready and dictionary representations using the <em>as_system_dicts()</em> and <em>as_rule_dicts()</em> methods respectively. For the former method, we need to provide the Cassandra datatypes for each pipeline output field, as well as their Cassandra field names. This can be returned using the <em>return_cassandra_dtypes</em> module from the <em>simility_requests</em> sub-package (but are defined explicitly above in this example).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">system_dicts</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">as_system_dicts</span><span class="p">(</span><span class="n">field_datatypes</span><span class="o">=</span><span class="n">field_datatypes</span><span class="p">,</span> <span class="n">cassandra_field_names</span><span class="o">=</span><span class="n">cassandra_field_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_dicts</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">as_rule_dicts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>Outputs<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>The <em>.as_system_dicts()</em> method returns a dictionary of the set of rules defined using the system-ready format (values) and their names (keys). It also saves this dictionary as the class attribute <em>system_dicts</em>.</p>
<p>The <em>.as_rule_dicts()</em> method returns a dictionary of the set of rules defined using the standard ARGO dictionary format (values) and their names (keys). It also saves this dictionary as the class attribute <em>rule_dicts</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">system_dicts</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: {&#39;condition&#39;: &#39;AND&#39;,
  &#39;rules&#39;: [{&#39;condition&#39;: &#39;OR&#39;,
    &#39;rules&#39;: [{&#39;field&#39;: &#39;payer_id.sum_approved_txn_amt_per_paypalid_1day&#39;,
      &#39;operator&#39;: &#39;greater_or_equal&#39;,
      &#39;value&#39;: &#39;value.60.0&#39;,
      &#39;id&#39;: &#39;payer_id.sum_approved_txn_amt_per_paypalid_1day&#39;,
      &#39;type&#39;: &#39;double&#39;},
     {&#39;field&#39;: &#39;payer_id.sum_approved_txn_amt_per_paypalid_7day&#39;,
      &#39;operator&#39;: &#39;greater&#39;,
      &#39;value&#39;: &#39;value.120.0&#39;,
      &#39;id&#39;: &#39;payer_id.sum_approved_txn_amt_per_paypalid_7day&#39;,
      &#39;type&#39;: &#39;double&#39;},
     {&#39;field&#39;: &#39;payer_id.sum_approved_txn_amt_per_paypalid_30day&#39;,
      &#39;operator&#39;: &#39;less_or_equal&#39;,
      &#39;value&#39;: &#39;value.500.0&#39;,
      &#39;id&#39;: &#39;payer_id.sum_approved_txn_amt_per_paypalid_30day&#39;,
      &#39;type&#39;: &#39;double&#39;}]},
   {&#39;field&#39;: &#39;num_items&#39;,
    &#39;operator&#39;: &#39;equal&#39;,
    &#39;value&#39;: &#39;value.1&#39;,
    &#39;id&#39;: &#39;num_items&#39;,
    &#39;type&#39;: &#39;integer&#39;}]},
 &#39;Rule2&#39;: {&#39;condition&#39;: &#39;AND&#39;,
  &#39;rules&#39;: [{&#39;field&#39;: &#39;ml_cc_v0&#39;,
    &#39;operator&#39;: &#39;less&#39;,
    &#39;value&#39;: &#39;value.0.315&#39;,
    &#39;id&#39;: &#39;ml_cc_v0&#39;,
    &#39;type&#39;: &#39;double&#39;},
   {&#39;condition&#39;: &#39;OR&#39;,
    &#39;rules&#39;: [{&#39;field&#39;: &#39;method_clean&#39;,
      &#39;operator&#39;: &#39;equal&#39;,
      &#39;value&#39;: &#39;value.checkout&#39;,
      &#39;id&#39;: &#39;method_clean&#39;,
      &#39;type&#39;: &#39;string&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;,
      &#39;operator&#39;: &#39;begins_with&#39;,
      &#39;value&#39;: &#39;value.checkout&#39;,
      &#39;id&#39;: &#39;method_clean&#39;,
      &#39;type&#39;: &#39;string&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;,
      &#39;operator&#39;: &#39;ends_with&#39;,
      &#39;value&#39;: &#39;value.checkout&#39;,
      &#39;id&#39;: &#39;method_clean&#39;,
      &#39;type&#39;: &#39;string&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;,
      &#39;operator&#39;: &#39;contains&#39;,
      &#39;value&#39;: &#39;value.checkout&#39;,
      &#39;id&#39;: &#39;method_clean&#39;,
      &#39;type&#39;: &#39;string&#39;},
     {&#39;field&#39;: &#39;ip_address&#39;,
      &#39;operator&#39;: &#39;is_not_null&#39;,
      &#39;value&#39;: None,
      &#39;id&#39;: &#39;ip_address&#39;,
      &#39;type&#39;: &#39;string&#39;},
     {&#39;field&#39;: &#39;ip_isp&#39;,
      &#39;operator&#39;: &#39;is_not_empty&#39;,
      &#39;value&#39;: None,
      &#39;id&#39;: &#39;ip_isp&#39;,
      &#39;type&#39;: &#39;string&#39;}]}]}}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_dicts</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: {&#39;condition&#39;: &#39;AND&#39;,
  &#39;rules&#39;: [{&#39;condition&#39;: &#39;OR&#39;,
    &#39;rules&#39;: [{&#39;field&#39;: &#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;,
      &#39;operator&#39;: &#39;greater_or_equal&#39;,
      &#39;value&#39;: 60.0},
     {&#39;field&#39;: &#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;,
      &#39;operator&#39;: &#39;greater&#39;,
      &#39;value&#39;: 120.0},
     {&#39;field&#39;: &#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;,
      &#39;operator&#39;: &#39;less_or_equal&#39;,
      &#39;value&#39;: 500.0}]},
   {&#39;field&#39;: &#39;num_items&#39;, &#39;operator&#39;: &#39;equal&#39;, &#39;value&#39;: 1.0}]},
 &#39;Rule2&#39;: {&#39;condition&#39;: &#39;AND&#39;,
  &#39;rules&#39;: [{&#39;field&#39;: &#39;ml_cc_v0&#39;, &#39;operator&#39;: &#39;less&#39;, &#39;value&#39;: 0.315},
   {&#39;condition&#39;: &#39;OR&#39;,
    &#39;rules&#39;: [{&#39;field&#39;: &#39;method_clean&#39;,
      &#39;operator&#39;: &#39;equal&#39;,
      &#39;value&#39;: &#39;checkout&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;, &#39;operator&#39;: &#39;begins_with&#39;, &#39;value&#39;: &#39;checkout&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;, &#39;operator&#39;: &#39;ends_with&#39;, &#39;value&#39;: &#39;checkout&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;, &#39;operator&#39;: &#39;contains&#39;, &#39;value&#39;: &#39;checkout&#39;},
     {&#39;field&#39;: &#39;ip_address&#39;, &#39;operator&#39;: &#39;is_not_null&#39;, &#39;value&#39;: None},
     {&#39;field&#39;: &#39;ip_isp&#39;, &#39;operator&#39;: &#39;is_not_empty&#39;, &#39;value&#39;: None}]}]}}
</pre></div></div>
</div>
<hr class="docutils" />
</div>
</div>
</div>
<div class="section" id="Converting-to-lambda-expressions">
<h2>Converting to lambda expressions<a class="headerlink" href="#Converting-to-lambda-expressions" title="Permalink to this headline">¶</a></h2>
<p>Once a rule set has been defined using one of the three representations, it can be converted to the lambda expression format. This format allows different values to be injected into the rule string, which can then be evaluated on a dataset. This is very useful for when we optimise existing rules on a dataset.</p>
<p>We can use the above instantiated Rules class along with the <em>.as_rule_lambdas()</em> method to convert the rules to the lambda expression format. The lambda expressions can be created such that they receive either keyword arguments as inputs, or positional arguments as inputs).</p>
<div class="section" id="with_kwargs-=-True">
<h3>with_kwargs = True<a class="headerlink" href="#with_kwargs-=-True" title="Permalink to this headline">¶</a></h3>
<p>Let’s first convert the rule set to lambda expressions that receive keyword arguments as inputs:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_lambdas</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">as_rule_lambdas</span><span class="p">(</span><span class="n">as_numpy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">with_kwargs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>Outputs<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>The <em>.as_rule_lambdas()</em> method returns a dictionary of the set of rules defined using the standard ARGO lambda expression format (values) and their names (keys). It also saves this dictionary as the class attribute <em>rule_lambdas</em>.</p>
<p>Three useful attributes created by running the <em>.as_rule_lambdas()</em> method are:</p>
<ul class="simple">
<li><p>lambda_kwargs (dict): For each rule (keys), a dictionary containing the features used in the rule (keys) and the current values (values). <strong>Only populates when .as_rule_lambdas() is used with the keyword argument with_kwargs=True.</strong></p></li>
<li><p>lambda_args (dict): For each rule (keys), a list containing the current values used in the rule. <strong>Only populates when .as_rule_lambdas() is used with the keyword argument with_kwargs=False.</strong></p></li>
<li><p>rule_features (dict): For each rule (keys), a list containing the features used in the rule. <strong>Only populates when .as_rule_lambdas() is used with the keyword argument with_kwargs=False.</strong></p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_lambdas</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: &lt;function rules.convert_rule_dicts_to_rule_strings.ConvertRuleDictsToRuleStrings._convert_to_lambda.&lt;locals&gt;._make_lambda.&lt;locals&gt;.&lt;lambda&gt;(**kwargs)&gt;,
 &#39;Rule2&#39;: &lt;function rules.convert_rule_dicts_to_rule_strings.ConvertRuleDictsToRuleStrings._convert_to_lambda.&lt;locals&gt;._make_lambda.&lt;locals&gt;.&lt;lambda&gt;(**kwargs)&gt;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span><span class="o">.</span><span class="n">lambda_kwargs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: {&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;: 60.0,
  &#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;: 120.0,
  &#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;: 500.0,
  &#39;num_items&#39;: 1.0},
 &#39;Rule2&#39;: {&#39;ml_cc_v0&#39;: 0.315}}
</pre></div></div>
</div>
<p>Across both rules, we have the following features: payer_id_sum_approved_txn_amt_per_paypalid_1day, payer_id_sum_approved_txn_amt_per_paypalid_7day, payer_id_sum_approved_txn_amt_per_paypalid_30day, num_items, ml_cc_v0, method_clean, ip_address and ip_isp.</p>
<p>A few points to note:</p>
<ul class="simple">
<li><p><strong>When the same feature is used more than once in a given rule, a suffix with the format ‘%&lt;n&gt;’ will be added, where n is a counter used to distinguish the conditions.</strong></p></li>
<li><p><strong>The values of some of these features cannot be changed, since the conditions related to these features do not have values - feature ‘ip_address’ is checked for nulls and feature ‘ip_isp’ is checked for empty cells. These are omitted from the lambda_kwargs class attribute (as seen above).</strong></p></li>
</ul>
<p>So we can construct a dictionary for each rule, for the features whose values can be changed. The keys of each dictionary are the features, with the values being the new values that we want to try in the rule:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">new_values</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>
        <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">,</span>
        <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;</span><span class="p">:</span> <span class="mf">600.0</span><span class="p">,</span>
        <span class="s1">&#39;num_items&#39;</span><span class="p">:</span> <span class="mf">2.0</span>
    <span class="p">},</span>
    <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ml_cc_v0&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span>
        <span class="s1">&#39;method_clean%0&#39;</span><span class="p">:</span> <span class="s1">&#39;bad_&#39;</span><span class="p">,</span>
        <span class="s1">&#39;method_clean%1&#39;</span><span class="p">:</span> <span class="s1">&#39;_bad&#39;</span><span class="p">,</span>
        <span class="s1">&#39;method_clean%2&#39;</span><span class="p">:</span> <span class="s1">&#39;fraud&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Then we can loop through the rules, inject the new values into the lambda expression and evaluate it (with the new values) on the dataset:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">rule_name</span><span class="p">,</span> <span class="n">rule_lambda</span> <span class="ow">in</span> <span class="n">rules</span><span class="o">.</span><span class="n">rule_lambdas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">new_values_for_rule</span> <span class="o">=</span> <span class="n">new_values</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span>
    <span class="n">X_rules</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">rule_lambda</span><span class="p">(</span><span class="o">**</span><span class="n">new_values_for_rule</span><span class="p">))</span>
<span class="n">X_rules</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_rules</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Rule1     99
Rule2    352
dtype: int64
</pre></div></div>
</div>
<p>We can also use the <strong>lambda_kwargs</strong> class attribute to inject the original values into the lambda expression and evaluate it on the dataset:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">rule_name</span><span class="p">,</span> <span class="n">rule_lambda</span> <span class="ow">in</span> <span class="n">rules</span><span class="o">.</span><span class="n">rule_lambdas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">X_rules</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">rule_lambda</span><span class="p">(</span><span class="o">**</span><span class="n">rules</span><span class="o">.</span><span class="n">lambda_kwargs</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]))</span>
<span class="n">X_rules</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_rules</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Rule1     96
Rule2    233
dtype: int64
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="with_kwargs-=-False">
<h3>with_kwargs = False<a class="headerlink" href="#with_kwargs-=-False" title="Permalink to this headline">¶</a></h3>
<p>Now let’s convert the rule set to lambda expressions that receive positions arguments as inputs:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_lambdas</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">as_rule_lambdas</span><span class="p">(</span><span class="n">as_numpy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">with_kwargs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4>Outputs<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>The <em>.as_rule_lambdas()</em> method returns a dictionary of the set of rules defined using the standard ARGO lambda expression format (values) and their names (keys). It also saves this dictionary as the class attribute <em>rule_lambdas</em>.</p>
<p>Three useful attributes created by running the <em>.as_rule_lambdas()</em> method are:</p>
<ul class="simple">
<li><p>lambda_kwargs (dict): For each rule (keys), a dictionary containing the features used in the rule (keys) and the current values (values). <strong>Only populates when .as_rule_lambdas() is used with the keyword argument with_kwargs=True.</strong></p></li>
<li><p>lambda_args (dict): For each rule (keys), a list containing the current values used in the rule. <strong>Only populates when .as_rule_lambdas() is used with the keyword argument with_kwargs=False.</strong></p></li>
<li><p>rule_features (dict): For each rule (keys), a list containing the features used in the rule. <strong>Only populates when .as_rule_lambdas() is used with the keyword argument with_kwargs=False.</strong></p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_lambdas</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: &lt;function rules.convert_rule_dicts_to_rule_strings.ConvertRuleDictsToRuleStrings._convert_to_lambda.&lt;locals&gt;._make_lambda.&lt;locals&gt;.&lt;lambda&gt;(*args)&gt;,
 &#39;Rule2&#39;: &lt;function rules.convert_rule_dicts_to_rule_strings.ConvertRuleDictsToRuleStrings._convert_to_lambda.&lt;locals&gt;._make_lambda.&lt;locals&gt;.&lt;lambda&gt;(*args)&gt;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span><span class="o">.</span><span class="n">lambda_args</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: [60.0, 120.0, 500.0, 1.0], &#39;Rule2&#39;: [0.315]}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span><span class="o">.</span><span class="n">rule_features</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: [&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;,
  &#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;,
  &#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;,
  &#39;num_items&#39;],
 &#39;Rule2&#39;: [&#39;ml_cc_v0&#39;]}
</pre></div></div>
</div>
<p>Across both rules, we have the following features: payer_id_sum_approved_txn_amt_per_paypalid_1day, payer_id_sum_approved_txn_amt_per_paypalid_7day, payer_id_sum_approved_txn_amt_per_paypalid_30day, num_items, ml_cc_v0, method_clean, ip_address and ip_isp.</p>
<p><strong>Note that the values of some of these features cannot be changed, since the conditions related to these features do not have values - feature ‘ip_address’ is checked for nulls and feature ‘ip_isp’ is checked for empty cells. These are omitted from the lambda_args class attribute (as seen above).</strong></p>
<p>So we can construct a list for each rule, for the features whose values can be changed. The values of the list are new values that we want to try in the rules. We can use the <strong>rule_features</strong> class attribute to ensure we use the correct order:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">new_values</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mf">600.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span>
    <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;bad_&#39;</span><span class="p">,</span> <span class="s1">&#39;_bad&#39;</span><span class="p">,</span> <span class="s1">&#39;fraud&#39;</span><span class="p">]</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<p>Then we can loop through the rules, inject the new values into the lambda expression and evaluate it (with the new values) on the dataset:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">rule_name</span><span class="p">,</span> <span class="n">rule_lambda</span> <span class="ow">in</span> <span class="n">rules</span><span class="o">.</span><span class="n">rule_lambdas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">new_values_for_rule</span> <span class="o">=</span> <span class="n">new_values</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span>
    <span class="n">X_rules</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">rule_lambda</span><span class="p">(</span><span class="o">*</span><span class="n">new_values_for_rule</span><span class="p">))</span>
<span class="n">X_rules</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_rules</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Rule1     99
Rule2    352
dtype: int64
</pre></div></div>
</div>
<p>We can also use the <strong>lambda_args</strong> class attribute to inject the original values into the lambda expression and evaluate it on the dataset:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">rule_name</span><span class="p">,</span> <span class="n">rule_lambda</span> <span class="ow">in</span> <span class="n">rules</span><span class="o">.</span><span class="n">rule_lambdas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">X_rules</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">rule_lambda</span><span class="p">(</span><span class="o">*</span><span class="n">rules</span><span class="o">.</span><span class="n">lambda_args</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]))</span>
<span class="n">X_rules</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_rules</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Rule1     96
Rule2    233
dtype: int64
</pre></div></div>
</div>
<hr class="docutils" />
</div>
</div>
</div>
<div class="section" id="Filtering-rules">
<h2>Filtering rules<a class="headerlink" href="#Filtering-rules" title="Permalink to this headline">¶</a></h2>
<p>We can use the <em>.filter_rules()</em> method to filter a ruleset. Let’s say we define the following rule set, which consists of three rules:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_strings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&gt;120.0)&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Rule3&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;]&lt;=500.0)&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span> <span class="o">=</span> <span class="n">Rules</span><span class="p">(</span><span class="n">rule_strings</span><span class="o">=</span><span class="n">rule_strings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span><span class="o">.</span><span class="n">rule_strings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: &#34;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)&#34;,
 &#39;Rule2&#39;: &#34;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&gt;120.0)&#34;,
 &#39;Rule3&#39;: &#34;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;]&lt;=500.0)&#34;}
</pre></div></div>
</div>
<p>Now we can filter the rule set to include or exclude those rules stated:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span><span class="o">.</span><span class="n">filter_rules</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Rule1&#39;</span><span class="p">],</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>Outputs<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The <em>.filter_rules()</em> method does not return a value, however it does filter the rules within the class, based on the rules that were included or excluded:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span><span class="o">.</span><span class="n">rule_strings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: &#34;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)&#34;}
</pre></div></div>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="Returning-the-features-in-each-rule">
<h2>Returning the features in each rule<a class="headerlink" href="#Returning-the-features-in-each-rule" title="Permalink to this headline">¶</a></h2>
<p>We can use the <em>.get_rule_features()</em> method to return the unique set of features related to each rule. Let’s say we define the following rule set, which consists of three rules:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_strings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)&amp;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&gt;120.0)&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;num_order_items&#39;]&gt;20)|((X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&lt;100.0)&amp;(X[&#39;num_order_items&#39;]&gt;10))&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Rule3&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;]&lt;=500.0)&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span> <span class="o">=</span> <span class="n">Rules</span><span class="p">(</span><span class="n">rule_strings</span><span class="o">=</span><span class="n">rule_strings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we can return the unique set of features related to each rule:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_features</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">get_rule_features</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Outputs<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The <em>.get_rule_features()</em> method return a dictionary of the unique set of features (values) related to each rule (keys):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_features</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: {&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;,
  &#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;},
 &#39;Rule2&#39;: {&#39;num_order_items&#39;,
  &#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;},
 &#39;Rule3&#39;: {&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;}}
</pre></div></div>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="The-End">
<h2>The End<a class="headerlink" href="#The-End" title="Permalink to this headline">¶</a></h2>
<p>That’s it folks - if you have any queries or suggestions please put them in the <em>#sim-datatools-help</em> Slack channel or email James directly.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="convert_processed_conditions_to_general_example.html" class="btn btn-neutral float-right" title="Convert Processed Conditions to General Example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="argo.rules.html" class="btn btn-neutral float-left" title="argo.rules package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Simility Data Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>